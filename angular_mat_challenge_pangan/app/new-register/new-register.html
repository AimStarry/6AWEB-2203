<div [class.dark-theme]="isDarkMode" class="page-wrapper">
  <mat-toolbar color="primary">
    <mat-icon>event_available</mat-icon>
    <span>Summit Registration 2026</span>
    <span class="spacer"></span>
    <mat-slide-toggle (change)="toggleTheme()" color="warn">
      <mat-icon>{{ isDarkMode ? 'dark_mode' : 'light_mode' }}</mat-icon>
    </mat-slide-toggle>
  </mat-toolbar>

  <div class="content-container">
    @if (!submitted) {
      <mat-card class="stepper-card">
        <mat-stepper linear #stepper>

          <mat-step [stepControl]="formdata.get('accountInfo')!">
            <form [formGroup]="$any(formdata.get('accountInfo'))">
              <ng-template matStepLabel>Account</ng-template>
              <mat-form-field appearance="outline">
                <mat-label>Username</mat-label>
                <input matInput formControlName="userName" required>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Password</mat-label>
                <input matInput type="password" formControlName="password" required>
                <mat-hint>Must start with a letter, 8+ alphanumeric</mat-hint>
                @if (formdata.get('accountInfo.password')?.hasError('pattern')) {
                  <mat-error>Alphanumeric only, start with a letter</mat-error>
                }
              </mat-form-field>

              <div class="action-buttons">
                <button mat-flat-button color="primary" matStepperNext type="button">Next</button>
              </div>
            </form>
          </mat-step>

          <mat-step [stepControl]="formdata.get('personalInfo')!">
            <form [formGroup]="$any(formdata.get('personalInfo'))">
              <ng-template matStepLabel>Personal</ng-template>
              <mat-form-field appearance="outline">
                <mat-label>Email Address</mat-label>
                <input matInput formControlName="email" required>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Date of Birth</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="birthDate" required>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                @if (formdata.get('personalInfo.birthDate')?.hasError('tooYoung')) {
                  <mat-error>Restricted to 2006 or earlier</mat-error>
                }
              </mat-form-field>

              <div class="radio-section">
                <label class="section-label">Gender Identity:</label>
                <mat-radio-group formControlName="gender">
                  <mat-radio-button value="male">Male</mat-radio-button>
                  <mat-radio-button value="female">Female</mat-radio-button>
                </mat-radio-group>
              </div>

              <div class="action-buttons">
                <button mat-button matStepperPrevious type="button">Back</button>
                <button mat-flat-button color="primary" matStepperNext type="button">Next</button>
              </div>
            </form>
          </mat-step>

          <mat-step>
            <form [formGroup]="$any(formdata.get('additionalInfo'))">
              <ng-template matStepLabel>Preferences</ng-template>
              <p class="section-label">Interest Tracks:</p>
              <mat-chip-set>
                @for (item of interests; track item) {
                  <mat-chip>{{item}}</mat-chip>
                }
              </mat-chip-set>

              <div class="slider-container">
                <label class="section-label">Skill Level</label>
                <mat-slider min="1" max="10" step="1" discrete><input matSliderThumb formControlName="skillLevel"></mat-slider>
              </div>

              <mat-checkbox formControlName="agree" required>I accept the policies</mat-checkbox>

              <div class="action-buttons">
                <button mat-button matStepperPrevious type="button">Back</button>
                <button mat-raised-button color="warn" (click)="onSubmit()" [disabled]="formdata.invalid">Submit</button>
              </div>
            </form>
          </mat-step>
        </mat-stepper>
      </mat-card>
    } @else {
      <div class="success-screen">
        <mat-icon class="done-icon">check_circle</mat-icon>
        <h2>Registration Confirmed!</h2>
        <p>Welcome to the Summit, {{formdata.value.accountInfo?.userName}}.</p>
        <button mat-button (click)="submitted = false">Register Another</button>
      </div>
    }

    <mat-accordion class="info-accordion">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Event Requirements</mat-panel-title>
        </mat-expansion-panel-header>
        <p>You must be born in 2006 or earlier to participate in technical workshops.</p>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
